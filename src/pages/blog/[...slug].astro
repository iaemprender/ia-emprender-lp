---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro'; // Ruta correcta a tu layout principal

// 1. FUNCIÓN OBLIGATORIA: Define las rutas de todos los posts
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug }, // Genera la URL (ej: /blog/first-post)
    props: { post },
  }));
}

// 2. DEFINE EL TIPO DE LA PROPIEDAD: Esto resuelve el error de tipado
type Props = {
    post: CollectionEntry<'blog'>;
};

// 3. ASIGNACIÓN EXPLÍCITA: Desestructuramos y asignamos el tipo 'Props'
const { post } = Astro.props as Props;
const { Content } = await post.render();

// 4. Formatear la fecha
const formattedDate = post.data.pubDate.toLocaleDateString('es-ES', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
});
---

<Layout title={post.data.title} hasTopBar={false} hasLegalFooter={false}>
    <div class="container mx-auto py-12 px-4 max-w-3xl">
        <article class="text-left">
            
            <header class="pb-6 border-b border-gray-200 mb-8">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-4 leading-tight">
                    {post.data.title}
                </h1>
                <p class="text-base text-gray-500">
                    <span class="font-bold text-red-600">{post.data.tag || 'General'}</span> | Publicado el {formattedDate}
                </p>
            </header>
            
            {post.data.heroImage && (
                <div class="mb-8">
                    <img 
                        src={post.data.heroImage} 
                        alt={post.data.title} 
                        class="w-full h-auto rounded-lg shadow-lg"
                    />
                </div>
            )}

            <div class="prose max-w-none text-gray-800">
                <Content />
            </div>
            
        </article>
        
        <div class="mt-12 text-center pt-8 border-t border-gray-200">
            <a href="/blog" class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-full transition duration-300">
                ← Volver al Índice del Blog
            </a>
        </div>
    </div>
</Layout>