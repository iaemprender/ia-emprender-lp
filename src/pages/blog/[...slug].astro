---
import { getCollection, type CollectionEntry, render } from 'astro:content';
// La ruta '../../layouts/Layout.astro' es la correcta para archivos anidados en /pages/blog/
import Layout from '../../layouts/Layout.astro'; 

// 1. FUNCIÓN OBLIGATORIA: Define las rutas de todos los posts
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  // CORRECCIÓN: Tipado explícito de 'post: CollectionEntry<"blog">' para resolver el error de 'slug'.
  return posts.map((post: CollectionEntry<'blog'>) => {
    // Definimos el slug explícitamente primero
    const postSlug = post.slug; 
    return ({
      params: { slug: postSlug }, // Usamos la nueva variable aquí
      props: { post },
    });
  });
}

// 2. DEFINE EL TIPO DE LA PROPIEDAD: Esto elimina el error de tipado 'any'
type Props = {
  post: CollectionEntry<'blog'>;
};

// 3. ASIGNACIÓN EXPLÍCITA y CORRECCIÓN DE RENDER
const { post } = Astro.props as Props;
const { Content } = await render(post); 

// 4. Formatear la fecha
const formattedDate = post.data.pubDate.toLocaleDateString('es-ES', { 
  year: 'numeric', 
  month: 'long', 
  day: 'numeric' 
});
---

<Layout title={post.data.title} hasTopBar={false} hasLegalFooter={false}>
    <div class="container mx-auto py-12 px-4 max-w-3xl">
        <article class="text-left">
            <header class="pb-6 border-b border-gray-200 mb-8">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-4 leading-tight">
                    {post.data.title}
                </h1>
                <p class="text-base text-gray-500">
                    <span class="font-bold text-red-600">{post.data.tag || 'General'}</span> | Publicado el {formattedDate}
                </p>
            </header>
            
            {post.data.heroImage && (
                <div class="mb-8">
                    <img 
                        src={post.data.heroImage} 
                        alt={post.data.title} 
                        class="w-full h-auto rounded-lg shadow-lg"
                    />
                </div>
            )}

            <div class="prose max-w-none text-gray-800">
                <Content />
            </div>
            
        </article>
        
        <div class="mt-12 text-center pt-8 border-t border-gray-200">
            <a href="/blog" class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-full transition duration-300">
                ← Volver al Índice del Blog
            </a>
        </div>
    </div>
</Layout>
